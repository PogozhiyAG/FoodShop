<!DOCTYPE html>
<!-- saved from url=(0022)http://localhost:5500/ -->
<html><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
    <title>Проект "Комменты"</title>
    
    <link rel="stylesheet" href="./Проект _Комменты__files/styles.css">    
  </head>

  <body>
    <div class="container">
      <ul class="comments" id="list-comments">
        <li class="comment">
          <div class="comment-header">
            <div>Глеб Фокин</div>
            <div>12.02.22 12:18</div>
          </div>
          <div class="comment-body">
            <div class="comment-text">
              Это будет первый комментарий на этой странице
            </div>
          </div>
          <div class="comment-footer">
            <div class="likes">
              <span class="likes-counter">3</span>
              <button class="like-button"></button>
            </div>
          </div>
        </li>
        <li class="comment">
          <div class="comment-header">
            <div>Варвара Н.</div>
            <div>13.02.22 19:22</div>
          </div>
          <div class="comment-body">
            <div class="comment-text">
              Мне нравится как оформлена эта страница! ❤
            </div>
          </div>
          <div class="comment-footer">
            <div class="likes">
              <span class="likes-counter">75</span>
              <button class="like-button -active-like"></button>
            </div>
          </div>
        </li>
      
      <li class="comment">
        <div class="comment-header">
          <div>werwer</div>
          <div>06.10.23 18:58</div>
        </div>
        <div class="comment-body">
          <div class="comment-text">
            <pre>erterty
drgdtg
</pre>
          </div>
        </div>
        <div class="comment-footer">
          <div class="likes">
            <span class="likes-counter">0</span>
            <button class="like-button"></button>
          </div>
        </div>
      </li>
    </ul>
      <div class="add-form">
        <input type="text" class="add-form-name" placeholder="Введите ваше имя">
        <textarea type="textarea" class="add-form-text" placeholder="Введите ваш коментарий" rows="4"></textarea>
        <div class="add-form-row">
          <button class="add-form-button" id="button-add-comment">Написать</button>
        </div>
      </div>
    </div>

    <script type="text/html" id="template-comment">
      <li class="comment">
        <div class="comment-header">
          <div>{name}</div>
          <div>{date}</div>
        </div>
        <div class="comment-body">
          <div class="comment-text">
            <pre>{comment}</pre>
          </div>
        </div>
        <div class="comment-footer">
          <div class="likes">
            <span class="likes-counter">0</span>
            <button class="like-button"></button>
          </div>
        </div>
      </li>
    </script>

  <!-- Code injected by live-server -->
<script>
	// <![CDATA[  <-- For SVG support
	if ('WebSocket' in window) {
		(function () {
			function refreshCSS() {
				var sheets = [].slice.call(document.getElementsByTagName("link"));
				var head = document.getElementsByTagName("head")[0];
				for (var i = 0; i < sheets.length; ++i) {
					var elem = sheets[i];
					var parent = elem.parentElement || head;
					parent.removeChild(elem);
					var rel = elem.rel;
					if (elem.href && typeof rel != "string" || rel.length == 0 || rel.toLowerCase() == "stylesheet") {
						var url = elem.href.replace(/(&|\?)_cacheOverride=\d+/, '');
						elem.href = url + (url.indexOf('?') >= 0 ? '&' : '?') + '_cacheOverride=' + (new Date().valueOf());
					}
					parent.appendChild(elem);
				}
			}
			var protocol = window.location.protocol === 'http:' ? 'ws://' : 'wss://';
			var address = protocol + window.location.host + window.location.pathname + '/ws';
			var socket = new WebSocket(address);
			socket.onmessage = function (msg) {
				if (msg.data == 'reload') window.location.reload();
				else if (msg.data == 'refreshcss') refreshCSS();
			};
			if (sessionStorage && !sessionStorage.getItem('IsThisFirstTime_Log_From_LiveServer')) {
				console.log('Live reload enabled.');
				sessionStorage.setItem('IsThisFirstTime_Log_From_LiveServer', true);
			}
		})();
	}
	else {
		console.error('Upgrade your browser. This Browser is NOT supported WebSocket for Live-Reloading.');
	}
	// ]]>
</script>


  <script>
    "use strict";
    const formAddComment = document.getElementsByClassName('add-form')[0];
    const inputName = formAddComment.getElementsByClassName('add-form-name')[0];
    const inputComment = formAddComment.getElementsByClassName('add-form-text')[0];
    const inputs = [inputName, inputComment];

    const listComments = document.getElementById('list-comments');
    const buttonAddComment = document.getElementById('button-add-comment');
    const templateComment = document.getElementById('template-comment');

    const validationState = {
      isNameValid: false,
      setIsNameValid(state) { this.isNameValid = state; if(this.onchange) this.onchange(); return state; },
      isCommentValid: false,
      setIsCommentValid(state) { this.isCommentValid = state; if(this.onchange) this.onchange(); return state; },
      isValid(){
        return this.isNameValid && this.isCommentValid;
      }
    };

    const formatDateTime = (date) => {
      const day = String(date.getDate()).padStart(2, '0');
      const month = String(date.getMonth()).padStart(2, '0');
      const year = String(date.getFullYear() - 2000);
      const minutes = String(date.getMinutes()).padStart(2, '0');
      const hours = String(date.getHours()).padStart(2, '0');
      return `${day}.${month}.${year} ${hours}:${minutes}`;
    };

    const addComment = (name, comment) => {
      let template = templateComment.innerHTML;
      
      template = template
        .replaceAll('{name}', name)
        .replaceAll('{date}', formatDateTime(new Date()))
        .replaceAll('{comment}', comment);

      listComments.innerHTML = listComments.innerHTML + template;

      console.log(template);
    };

    const inputIsNotEmpty = (i) => i.value.trim() !== '';

    const validateName = () => validationState.setIsNameValid(inputIsNotEmpty(inputName));
    const validateComment = () => validationState.setIsCommentValid(inputIsNotEmpty(inputComment));

    const setAddCommentButtonEnabled = () => {
      buttonAddComment.disabled = !validationState.isValid();
    };

    const setInputValidityStatus = (input, status) =>{
      if(status){
        input.classList.remove('error');
      } else {
        input.classList.add('error');
      }
      return status;
    };

    const validate = () => {
      const nameIsValid = setInputValidityStatus(inputName, validateName());
      const commentIsValid = setInputValidityStatus(inputComment, validateComment());
      return nameIsValid && commentIsValid;
    }

    const validateAndSend = () => {      
      if(!validate()){
        return;
      }
      
      addComment(inputName.value, inputComment.value);
      
      inputComment.value = '';
      validateComment();
    }
    
    inputName.addEventListener('input', () =>{
      validateName();
    });
    inputComment.addEventListener('input', () =>{
      validateComment();
    });
    inputComment.addEventListener('keydown', (e) =>{
      if(e.code == 'Enter'){
        validateAndSend();
        return false;
      }
    });
    buttonAddComment.addEventListener('click', validateAndSend);
    validationState.onchange = () => setAddCommentButtonEnabled();

    validateName();
    validateComment();
  </script>

</body></html>